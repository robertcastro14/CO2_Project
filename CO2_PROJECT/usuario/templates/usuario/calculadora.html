{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    .calc-wrapper {
        max-width: 100%;
        margin: 0 auto;
        padding: 2rem;
    }

    /* --- CART√ïES COM MAIS PERSONALIDADE --- */
    .form-card, .comp-card {
        background-color: #ffffff;
        border-radius: 16px;
        /* Sombra mais forte e difusa para destaque */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); 
        padding: 2.5rem;
        border: 1px solid #f0f0f0;
        /* Borda colorida no topo para identidade visual */
        border-top: 6px solid #2E7D32; 
        height: 100%;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .form-card:hover, .comp-card:hover {
        transform: translateY(-5px); /* Leve levita√ß√£o ao passar o mouse */
        box-shadow: 0 15px 35px rgba(46, 125, 50, 0.15); /* Sombra verde suave */
    }

    /* --- INPUTS --- */
    .custom-input {
        background-color: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 14px 18px;
        font-size: 1.05rem;
        transition: all 0.2s;
    }
    .custom-input:focus {
        background-color: #fff;
        border-color: #2E7D32;
        box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.1);
    }

    /* --- BOT√ÉO DE A√á√ÉO --- */
    .btn-calcular {
        /* Gradiente sutil para ficar mais "clic√°vel" */
        background: linear-gradient(135deg, #2E7D32 0%, #1b5e20 100%);
        color: white;
        font-weight: 700;
        border: none;
        padding: 14px;
        border-radius: 12px;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        transition: all 0.3s;
    }
    .btn-calcular:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        color: white;
    }

    /* --- COMPARATIVO --- */
    .comp-row {
        display: flex;
        align-items: center;
        margin-bottom: 1.2rem;
        padding: 1rem;
        background: #fff;
        border: 1px solid #f1f3f5;
        border-radius: 12px;
        transition: all 0.2s;
    }
    .comp-row:hover {
        border-color: #2E7D32;
        background: #fdfdfd;
    }

    /* √çcones com fundo circular */
    .icon-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .progress-stacked {
        height: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
        margin-top: 8px;
        width: 100%;
    }
</style>

<div class="calc-wrapper">
    <div class="row g-5">
        
        <div class="col-lg-7">
            <div class="form-card">
                
                <div class="mb-5">
                    <h2 class="fw-bold text-dark mb-2 d-flex align-items-center">
                        <span class="icon-circle bg-success text-white me-3 shadow-sm" style="width: 40px; height: 40px; font-size: 1.2rem;">
                            <i class="bi bi-calculator"></i>
                        </span>
                        Simulador de CO‚ÇÇ
                    </h2>
                    <p class="text-muted ms-5 ps-2">Preencha os dados para calcular sua pegada ecol√≥gica e gastos.</p>
                </div>

                <form method="POST">
                    {% csrf_token %}
                    
                    {% if resultado.erro %}
                        <div class="alert alert-danger shadow-sm border-0 rounded-3 mb-4">
                            <i class="bi bi-exclamation-circle-fill me-2"></i>{{ resultado.erro }}
                        </div>
                    {% endif %}

                    <div class="mb-4">
                        <label class="form-label fw-bold text-dark small text-uppercase ls-1">Dist√¢ncia (km)</label>
                        <input type="number" step="0.1" name="distancia" id="input-distancia"
                               class="form-control custom-input" 
                               placeholder="Ex: 15" 
                               value="{{ resultado.distancia|default_if_none:'' }}" required>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold text-dark small text-uppercase ls-1">Meio de Transporte</label>
                        <select name="transporte" id="select-transporte" class="form-select custom-input" required onchange="toggleCombustivel()">
                            <option value="" disabled {% if not resultado.transporte %}selected{% endif %}>‚Äî Selecione ‚Äî</option>
                            <option value="carro" {% if resultado.transporte == 'Carro' %}selected{% endif %}>üöó Carro (Gasolina)</option>
                            <option value="moto" {% if resultado.transporte == 'Moto' %}selected{% endif %}>üèçÔ∏è Motocicleta</option>
                            <option value="onibus" {% if resultado.transporte == 'Onibus' %}selected{% endif %}>üöå √înibus</option>
                            <option value="metro" {% if resultado.transporte == 'Metro' %}selected{% endif %}>üöÜ Metr√¥/Trem</option>
                            <option value="bicicleta" {% if resultado.transporte == 'Bicicleta' %}selected{% endif %}>üö≤ Bicicleta</option>
                            <option value="caminhada" {% if resultado.transporte == 'Caminhada' %}selected{% endif %}>üö∂ A p√©</option>
                        </select>
                    </div>

                    <div id="combustivel-inputs" class="row g-3 mb-4" style="display: none;">
                        <div class="col-md-6">
                            <label class="form-label fw-bold text-dark small text-uppercase ls-1">Pre√ßo Gasolina (R$)</label>
                            <input type="number" step="0.01" name="preco" class="form-control custom-input" 
                                   placeholder="Ex: 5.89" value="{{ resultado.preco|default_if_none:'' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold text-dark small text-uppercase ls-1">Consumo (km/L)</label>
                            <input type="number" step="0.1" name="consumo" class="form-control custom-input" 
                                   placeholder="Ex: 10" value="{{ resultado.consumo|default_if_none:'' }}">
                        </div>
                        <div class="col-12">
                            <small class="text-muted d-flex align-items-center">
                                <i class="bi bi-info-circle me-1"></i> Preencha para estimar o custo da viagem.
                            </small>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-8">
                            <button type="submit" class="btn btn-calcular w-100">
                                <i class="bi bi-lightning-charge-fill me-2"></i>Calcular Impacto
                            </button>
                        </div>
                        <div class="col-md-4">
                            <a href="{% url 'calculadora' %}" class="btn btn-outline-secondary w-100 py-3 rounded-3 fw-bold border-2">
                                Limpar
                            </a>
                        </div>
                    </div>

                    {% if resultado and not resultado.erro %}
                    <div class="mt-5 p-4 rounded-4 text-center position-relative overflow-hidden" 
                         style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border: 1px solid #a5d6a7;">
                        
                        <p class="small text-uppercase fw-bold text-success mb-2">Sua Emiss√£o Estimada</p>
                        <h1 class="display-3 fw-bold text-dark mb-0" style="letter-spacing: -2px;">
                            {{ resultado.emissao_kg }} <span class="fs-4 text-muted">kg</span>
                        </h1>
                        
                        <div class="mt-3 pt-3 border-top border-success border-opacity-25 d-flex justify-content-center align-items-center gap-4 flex-wrap">
                            
                            <div class="d-flex align-items-center gap-2">
                                <div class="bg-white p-2 rounded-circle shadow-sm">
                                    <i class="bi bi-tree-fill text-success fs-5"></i>
                                </div>
                                <div class="text-start lh-1">
                                    <span class="d-block small text-uppercase fw-bold text-success opacity-75">Compensa√ß√£o</span>
                                    <span class="text-dark fw-bold">{{ resultado.arvores }} √°rvores</span>
                                </div>
                            </div>

                            {% if resultado.custo > 0 %}
                            <div class="d-flex align-items-center gap-2 border-start border-success border-opacity-25 ps-4">
                                <div class="bg-white p-2 rounded-circle shadow-sm">
                                    <i class="bi bi-cash-coin text-success fs-5"></i>
                                </div>
                                <div class="text-start lh-1">
                                    <span class="d-block small text-uppercase fw-bold text-success opacity-75">Gasto Estimado</span>
                                    <span class="text-dark fw-bold">R$ {{ resultado.custo }}</span>
                                </div>
                            </div>
                            {% endif %}

                        </div>
                    </div>
                    {% endif %}

                </form>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="comp-card h-100">
                
                <h4 class="fw-bold text-dark mb-4 pb-3 border-bottom">
                    <i class="bi bi-bar-chart-fill text-success me-2"></i>
                    {% if resultado %}
                        Comparativo ({{ resultado.distancia }} km)
                    {% else %}
                        Comparativo M√©dio (por km)
                    {% endif %}
                </h4>
                
                <div class="d-flex flex-column gap-2">
                    
                    <div class="comp-row">
                        <div class="icon-circle bg-success bg-opacity-10 text-success me-3">
                            <i class="bi bi-bicycle"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="fw-bold text-dark">Bicicleta</span>
                                <span class="fw-bold text-success" id="val-bike">0 kg</span>
                            </div>
                            <div class="progress-stacked">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="comp-row">
                        <div class="icon-circle bg-warning bg-opacity-10 text-warning me-3">
                            <i class="bi bi-train-front"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="fw-bold text-dark">Metr√¥ / Trem</span>
                                <span class="fw-bold text-dark" id="val-metro">0.04 kg</span>
                            </div>
                            <div class="progress-stacked">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 18%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="comp-row">
                        <div class="icon-circle bg-info bg-opacity-10 text-info me-3">
                            <i class="bi bi-bus-front"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="fw-bold text-dark">√înibus</span>
                                <span class="fw-bold text-dark" id="val-onibus">0.07 kg</span>
                            </div>
                            <div class="progress-stacked">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 35%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="comp-row border-danger border-opacity-25" style="background-color: #fff5f5;">
                        <div class="icon-circle bg-danger text-white me-3 shadow-sm">
                            <i class="bi bi-car-front-fill"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="fw-bold text-danger">Carro (Gasolina)</span>
                                <span class="fw-bold text-danger" id="val-carro">0.19 kg</span>
                            </div>
                            <div class="progress-stacked bg-white">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="mt-4 p-3 bg-light rounded-3 text-center">
                    <small class="text-muted">
                        *Valores estimados com base em fatores m√©dios de emiss√£o urbana.
                    </small>
                </div>

            </div>
        </div>

    </div>
</div>

<script>
    // Fun√ß√£o para mostrar/esconder campos de combust√≠vel
    function toggleCombustivel() {
        const select = document.getElementById('select-transporte');
        const inputsDiv = document.getElementById('combustivel-inputs');
        const valor = select.value;

        // Mostra apenas se for carro ou moto
        if (valor === 'carro' || valor === 'moto') {
            inputsDiv.style.display = 'flex';
        } else {
            inputsDiv.style.display = 'none';
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        // 1. Executa a fun√ß√£o ao carregar (para manter inputs vis√≠veis se j√° selecionado)
        toggleCombustivel();

        // 2. Atualiza o comparativo lateral (seu c√≥digo original mantido aqui)
        {% if resultado and not resultado.erro %}
            const dist = parseFloat("{{ resultado.distancia }}".replace(',', '.'));
            
            if (!isNaN(dist)) {
                const fMetro = 0.035;
                const fOnibus = 0.068;
                const fCarro = 0.192;

                document.getElementById('val-metro').innerText = (dist * fMetro).toFixed(2) + ' kg';
                document.getElementById('val-onibus').innerText = (dist * fOnibus).toFixed(2) + ' kg';
                document.getElementById('val-carro').innerText = (dist * fCarro).toFixed(2) + ' kg';
                document.getElementById('val-bike').innerText = '0.00 kg';
            }
        {% endif %}
    });
</script>

{% endblock %}