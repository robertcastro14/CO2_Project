{% extends 'base.html' %}
{% load static %}

{% block content %}

<main id="calculator-app" class="wrap container my-5" role="main" aria-labelledby="calc-title">
    
    <section class="card hero" aria-labelledby="calc-title">
        <h2 id="calc-title" class="fw-bold text-success"><i class="bi bi-car-front-fill me-2"></i> Calcule sua emiss√£o de CO‚ÇÇ</h2>
        <p class="small text-muted mb-4">Insira a dist√¢ncia e escolha o meio ‚Äî a estimativa √© baseada em fatores m√©dios por km.</p>

        <form class="calc" method="POST">
            {% csrf_token %}
            
            {% if form.errors %}
                <div class="alert alert-danger small mb-3">
                    <i class="bi bi-exclamation-triangle-fill"></i> Por favor, corrija os erros abaixo.
                </div>
            {% endif %}

            <div>
                <label class="input-label" for="id_distancia">
                    Dist√¢ncia (km)
                    <span class="small text-muted">Ex.: 12.5</span>
                </label>
                <input id="id_distancia" name="{{ form.distancia.name }}" type="number" min="0" step="0.1" inputmode="decimal" 
                       placeholder="Ex: 12.5" class="form-control" required 
                       value="{{ form.distancia.value|default_if_none:'' }}" />
                {% if form.distancia.errors %}<div class="text-danger small">{{ form.distancia.errors }}</div>{% endif %}
            </div>

            <div class="mt-3">
                <label class="input-label" for="id_transporte">Meio de transporte</label>
                <select id="id_transporte" name="{{ form.transporte.name }}" class="form-select" required>
                    {% for value, label in form.transporte.field.choices %}
                        <option value="{{ value }}" {% if form.transporte.value == value %}selected{% endif %}>
                            {% if value == 'Carro' %}üöó {{ label }}{% elif value == 'Onibus' %}üöå {{ label }}{% elif value == 'Bicicleta' %}üö≤ {{ label }}{% elif value == 'Metro/Trem' %}üöÜ {{ label }}{% else %}{{ label }}{% endif %}
                        </option>
                    {% endfor %}
                </select>
                {% if form.transporte.errors %}<div class="text-danger small">{{ form.transporte.errors }}</div>{% endif %}
            </div>

            <div class="btn-row mt-4">
                <button type="submit" class="primary">Calcular</button>
                <button type="reset" class="ghost">Limpar</button>
            </div>
            
            {% if resultado %}
            <div class="result" role="status" aria-atomic="true">
                <div>
                    <div class="small text-muted">Emiss√£o estimada</div>
                    <div class="value fw-bold text-dark" style="font-size: 2rem;">{{ resultado.emissao_kg }} kg CO‚ÇÇ</div>
                </div>
                <div style="text-align:right">
                    <div class="small text-muted">Compensa√ß√£o anual</div>
                    <div class="fw-bold text-success" style="font-size: 1.2rem;">{{ resultado.arvores }} √Årvores</div>
                </div>
            </div>
            {% endif %}
            
        </form>
    </section>

    <aside class="aside">
        <div class="card card-eco p-4" style="border-radius: var(--calc-radius);">
            <h3 class="fw-bold" style="margin:0;color:var(--calc-primary-600)">Recomenda√ß√µes r√°pidas</h3>
            <p class="small text-muted" style="margin-top:6px">Para trajetos sustent√°veis, considere as op√ß√µes abaixo:</p>

            <div class="modes">
                <div class="mode best p-3 mb-2">
                    <i class="bi bi-bicycle me-3" style="font-size: 32px; color: var(--calc-secondary-color);"></i>
                    <div><h4 class="fw-bold m-0">Bicicleta/A p√© ‚Äî 0 kg</h4><p class="small text-muted m-0">Ideal para dist√¢ncias at√© 5 km.</p></div>
                </div>

                <div class="mode p-3 mb-2">
                    <i class="bi bi-train-front me-3" style="font-size: 32px; color: var(--calc-secondary-color);"></i>
                    <div><h4 class="fw-bold m-0">Metr√¥/Trem ‚Äî baixo</h4><p class="small text-muted m-0">A melhor escolha para longas dist√¢ncias urbanas.</p></div>
                </div>
                
                <div class="mode p-3 mb-2">
                    <i class="bi bi-bus-front me-3" style="font-size: 32px; color: var(--calc-secondary-color);"></i>
                    <div><h4 class="fw-bold m-0">√înibus ‚Äî m√©dio-baixo</h4><p class="small text-muted m-0">Menor pegada por pessoa que o carro.</p></div>
                </div>

                <div style="text-align:center;margin-top:15px">
                    <a href="{% url 'historico' %}" class="btn btn-outline-success btn-sm" style="text-decoration:none;">
                        <i class="bi bi-clock-history me-1"></i> Ver Meu Hist√≥rico
                    </a>
                </div>
            </div>
        </div>
    </aside>

</main>
{% endblock content %}